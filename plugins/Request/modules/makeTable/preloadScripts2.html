<!--- ace scrip --->
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js"></script>


<script src="https://unpkg.com/prettier/standalone.js"></script>
<script src="https://unpkg.com/@prettier/plugin-php/standalone.js"></script>
<script src="js/script.js"></script>

<script>
    bootstrap = !bootstrap ? {} : bootstrap;
    $ = !$ ? {} : $;
    $().modal = !$().modal ? {} : $().modal;
    $().toast = !$().toast ? {} : $().toast;

    async function asyncGet(url) {
        try {
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`Request failed with status: ${response.status}`);
            }
            return await response.json();
        } catch (error) {
            console.error('Error during GET request:', error);
            throw error;
        }
    }

    function waitForDivContent() {
        return new Promise((resolve, reject) => {
            let intervalId = setInterval(() => {
                let div = document.getElementById('fp');
                if (div && div.innerHTML.trim() !== '') {
                    clearInterval(intervalId);
                    resolve();
                }
            }, 100);
        });
    }

    function wsConnect() {
        const hostname = window.location.port ? `${window.location.hostname}:${parseInt(window.location.port)}` : window.location.hostname;
        const ws = new WebSocket(`wss://${hostname}`);
        ws.onopen = function (event) {
            bootstrap.showToast({
                header: 'Bem vindo',
                body: 'Conectado ao servidor',
                toastClass: "bg-success text-white",
                colorHeader: 'text-white',
            });
            ws.send(JSON.stringify({
                token: $('#fp').text()
            }));
        };
        ws.onmessage = function (event) {
            const data = JSON.parse(event.data);
            if (data.success) {
                ws.send(JSON.stringify({
                    token: $('#fp').text()
                }));
                $('#totalDisk').html(`${data['disk']['total_space']} ${data['disk']['unit']}`);
                $('#diskUsed').html(`${data['disk']['used_space']} ${data['disk']['unit']}`);
                $('#freeDisk').html(`${data['disk']['free_space']} ${data['disk']['unit']}`);
                $('#progressDisk').css('width', `${data['disk']['used_percentage']}%`);
                $('#progressDisk').attr('class', `progress-bar ${data['disk']['background']}`);

                $('#totalMem').html(`${data['memory']['total_mem']} ${data['memory']['unit']}`);
                $('#memUsed').html(`${data['memory']['used_mem']} ${data['memory']['unit']}`);
                $('#memFree').html(`${data['memory']['free_mem']} ${data['memory']['unit']}`);
                $('#progressMem').css('width', `${data['memory']['used_percentage']}%`);
                $('#progressMem').attr('class', `progress-bar ${data['memory']['background']}`);

                $('#cpuName').html(data['cpu']['name']);
                $('#cpuUsed').html(`${data['cpu']['usage']} %`);
                $('#progressCpu').css('width', `${data['cpu']['usage']}%`);
                $('#freeCpu').html(`${parseFloat(100 - data['cpu']['usage'])} %`);
                $('#progressCpu').attr('class', `progress-bar ${data['cpu']['background']}`);
            }
        };
        ws.onerror = function (error) {
            setTimeout(wsConnect, 3000);
            return bootstrap.showToast({
                header: 'Erro',
                body: 'Não foi possível conectar ao servidor',
                toastClass: "bg-danger text-white",
                colorHeader: 'text-white',
            });
        };
    }

    function getIconFile(namefile) {
        let iconFileCompress = `<img src="img/desconhecido.png" width="26" alt="icon">`;
        let extension = namefile.split('.').pop();
        if (extension === 'folder') iconFileCompress = `<img src="img/pasta-aberta.png" width="26" alt="icon">`;
        if (extension === 'py') iconFileCompress = `<img src="img/python.png" width="26" alt="icon">`;
        if (extension === 'txt') iconFileCompress = `<img src="img/txt.png" width="26" alt="icon">`;
        if (extension === 'php') iconFileCompress = `<img src="img/php.png" width="26" alt="icon">`;
        if (extension === 'json') iconFileCompress = `<img src="img/json.png" width="26" alt="icon">`;
        if (extension === 'LICENSE') iconFileCompress = `<img src="img/diploma.png" width="26" alt="icon">`;
        if (extension === 'yml') iconFileCompress = `<img src="img/yaml.png" width="26" alt="icon">`;
        if (extension === 'dist') iconFileCompress = `<img src="img/dist.png" width="26" alt="icon">`;
        if (extension === 'md') iconFileCompress = `<img src="img/olho.png" width="26" alt="icon">`;
        if (extension === 'css') iconFileCompress = `<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b2/Bootstrap_logo.svg/2560px-Bootstrap_logo.svg.png" width="26" alt="icon">`;
        if (extension === 'scss') iconFileCompress = `<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b2/Bootstrap_logo.svg/2560px-Bootstrap_logo.svg.png" width="26" alt="icon">`;
        if (extension === 'lock') iconFileCompress = `<img src="img/trancar.png" width="26" alt="icon">`;
        if (extension === 'ttf') iconFileCompress = `<img src="img/font-file.png" width="26" alt="icon">`;
        if (extension === 'woff') iconFileCompress = `<img src="img/font-file.png" width="26" alt="icon">`;
        if (extension === 'eot') iconFileCompress = `<img src="img/trancar.png" width="26" alt="icon">`;
        if (extension === 'xml') iconFileCompress = `<img src="img/xml-file.png" width="26" alt="icon">`;
        if (extension === 'png') iconFileCompress = `<img src="img/image.png" width="26" alt="icon">`;
        if (extension === 'jpg') iconFileCompress = `<img src="img/image.png" width="26" alt="icon">`;
        if (extension === 'html') iconFileCompress = `<img src="img/html-5.png" width="26" alt="icon">`;
        if (extension === 'js') iconFileCompress = `<img src="img/js.png" width="26" alt="icon">`;
        if (extension === 'go') iconFileCompress = `<img src="img/go.png" width="26" alt="icon">`;
        if (extension === 'exe') iconFileCompress = `<img src="img/windows.png" width="26" alt="icon">`;
        if (extension === 'deb') iconFileCompress = `<img src="img/linux.png" width="26" alt="icon">`;
        if (extension === 'pkg') iconFileCompress = `<img src="img/linux.png" width="26" alt="icon">`;
        if (extension === 'so') iconFileCompress = `<img src="img/linux.png" width="26" alt="icon">`;
        if (extension === 'jar') iconFileCompress = `<img src="img/java.png" width="26" alt="icon">`;
        if (extension === 'cpp') iconFileCompress = `<img src="https://cdn-icons-png.flaticon.com/512/8304/8304381.png" width="26" alt="icon">`;
        if (extension === 'zip') iconFileCompress = `<img src="img/zip.png" width="26" alt="icon">`;
        if (extension === 'rar') iconFileCompress = `<img src="img/zip.png" width="26" alt="icon">`;
        if (extension === '7z') iconFileCompress = `<img src="img/zip.png" width="26" alt="icon">`;
        if (extension === 'tar') iconFileCompress = `<img src="img/zip.png" width="26" alt="icon">`;
        if (extension === 'gz') iconFileCompress = `<img src="img/zip.png" width="26" alt="icon">`;
        if (extension === 'bz2') iconFileCompress = `<img src="img/zip.png" width="26" alt="icon">`;
        if (extension === 'xz') iconFileCompress = `<img src="img/zip.png" width="26" alt="icon">`;
        if (extension === 'svg') iconFileCompress = `<img src="img/photoshop-lightroom.png" width="26" alt="icon">`;
        if (extension === 'mp3') iconFileCompress = `<img src="img/music-player.png" width="26" alt="icon">`;
        if (extension === 'mp4') iconFileCompress = `<img src="img/me.png" width="26" alt="icon">`;
        if (extension === 'Gemfile') iconFileCompress = `<img src="img/diamond.png" width="26" alt="icon">`;
        if (extension === 'Makefile') iconFileCompress = `<img src="img/letter-m.png" width="26" alt="icon">`;
        if (extension === 'eps') iconFileCompress = `<img src="img/photoshop-camera.png" width="26" alt="icon">`;
        if (extension === 'mkv') iconFileCompress = `<img src="img/me.png" width="26" alt="icon">`;
        if (extension === 'pdf') iconFileCompress = `<img src="img/pdf.svg" width="26" alt="icon">`;
        if (extension === 'gif') iconFileCompress = `<img src="img/gif.png" width="26" alt="icon">`;
        if (extension === 'dll') iconFileCompress = `<img src="img/dll.png" width="26" alt="icon">`;
        if (extension === 'wav') iconFileCompress = `<img src="img/wav-file.svg" width="26" alt="icon">`;
        if (extension === 'swf') iconFileCompress = `<img src="img/swf.png" width="26" alt="icon">`;
        return iconFileCompress;
    }

    function setItemsInTbody(items, tbodyId) {
        var tbody = document.getElementById(tbodyId);
        tbody.innerHTML = '';
        items.forEach(function (item) {
            let iconFileCompress = `<img src="img/desconhecido.png" width="26" alt="icon">`;
            var extension = item['typeFile'];
            if (extension === 'cfg') iconFileCompress = `<img src="img/cfg.png" width="26" alt="icon">`;
            if (extension === 'folder') iconFileCompress = `<img src="img/pasta-aberta.png" width="26" alt="icon">`;
            if (extension === 'py') iconFileCompress = `<img src="img/python.png" width="26" alt="icon">`;
            if (extension === 'txt') iconFileCompress = `<img src="img/txt.png" width="26" alt="icon">`;
            if (extension === 'php') iconFileCompress = `<img src="img/php.png" width="26" alt="icon">`;
            if (extension === 'json') iconFileCompress = `<img src="img/json.png" width="26" alt="icon">`;
            if (extension === 'LICENSE') iconFileCompress = `<img src="img/diploma.png" width="26" alt="icon">`;
            if (extension === 'key') iconFileCompress = `<img src="img/diploma.png" width="26" alt="icon">`;
            if (extension === 'crt') iconFileCompress = `<img src="img/diploma.png" width="26" alt="icon">`;
            if (extension === 'sh') iconFileCompress = `<img src="/img/cmd.png" width="26" alt="icon">`;
            if (extension === 'cmd') iconFileCompress = `<img src="/img/cmd.png" width="26" alt="icon">`;
            if (extension === 'yml') iconFileCompress = `<img src="img/yaml.png" width="26" alt="icon">`;
            if (extension === 'dist') iconFileCompress = `<img src="img/dist.png" width="26" alt="icon">`;
            if (extension === 'md') iconFileCompress = `<img src="img/olho.png" width="26" alt="icon">`;
            if (extension === 'css') iconFileCompress = `<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b2/Bootstrap_logo.svg/2560px-Bootstrap_logo.svg.png" width="26" alt="icon">`;
            if (extension === 'scss') iconFileCompress = `<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b2/Bootstrap_logo.svg/2560px-Bootstrap_logo.svg.png" width="26" alt="icon">`;
            if (extension === 'lock') iconFileCompress = `<img src="img/trancar.png" width="26" alt="icon">`;
            if (extension === 'ttf') iconFileCompress = `<img src="img/font-file.png" width="26" alt="icon">`;
            if (extension === 'woff') iconFileCompress = `<img src="img/font-file.png" width="26" alt="icon">`;
            if (extension === 'eot') iconFileCompress = `<img src="img/trancar.png" width="26" alt="icon">`;
            if (extension === 'xml') iconFileCompress = `<img src="img/xml-file.png" width="26" alt="icon">`;
            if (extension === 'png') iconFileCompress = `<img src="img/image.png" width="26" alt="icon">`;
            if (extension === 'jpg') iconFileCompress = `<img src="img/image.png" width="26" alt="icon">`;
            if (extension === 'html') iconFileCompress = `<img src="img/html-5.png" width="26" alt="icon">`;
            if (extension === 'js') iconFileCompress = `<img src="img/js.png" width="26" alt="icon">`;
            if (extension === 'go') iconFileCompress = `<img src="img/go.png" width="26" alt="icon">`;
            if (extension === 'exe') iconFileCompress = `<img src="img/windows.png" width="26" alt="icon">`;
            if (extension === 'deb') iconFileCompress = `<img src="img/linux.png" width="26" alt="icon">`;
            if (extension === 'pkg') iconFileCompress = `<img src="img/linux.png" width="26" alt="icon">`;
            if (extension === 'so') iconFileCompress = `<img src="img/linux.png" width="26" alt="icon">`;
            if (extension === 'jar') iconFileCompress = `<img src="img/java.png" width="26" alt="icon">`;
            if (extension === 'cpp') iconFileCompress = `<img src="https://cdn-icons-png.flaticon.com/512/8304/8304381.png" width="26" alt="icon">`;
            if (extension === 'zip') iconFileCompress = `<img src="img/zip.png" width="26" alt="icon">`;
            if (extension === 'rar') iconFileCompress = `<img src="img/zip.png" width="26" alt="icon">`;
            if (extension === '7z') iconFileCompress = `<img src="img/zip.png" width="26" alt="icon">`;
            if (extension === 'tar') iconFileCompress = `<img src="img/zip.png" width="26" alt="icon">`;
            if (extension === 'gz') iconFileCompress = `<img src="img/zip.png" width="26" alt="icon">`;
            if (extension === 'bz2') iconFileCompress = `<img src="img/zip.png" width="26" alt="icon">`;
            if (extension === 'xz') iconFileCompress = `<img src="img/zip.png" width="26" alt="icon">`;
            if (extension === 'svg') iconFileCompress = `<img src="img/photoshop-lightroom.png" width="26" alt="icon">`;
            if (extension === 'mp3') iconFileCompress = `<img src="img/music-player.png" width="26" alt="icon">`;
            if (extension === 'mp4') iconFileCompress = `<img src="img/me.png" width="26" alt="icon">`;
            if (extension === 'Gemfile') iconFileCompress = `<img src="img/diamond.png" width="26" alt="icon">`;
            if (extension === 'Makefile') iconFileCompress = `<img src="img/letter-m.png" width="26" alt="icon">`;
            if (extension === 'eps') iconFileCompress = `<img src="img/photoshop-camera.png" width="26" alt="icon">`;
            if (extension === 'mkv') iconFileCompress = `<img src="img/me.png" width="26" alt="icon">`;
            if (item.name === 'LICENSE') iconFileCompress = `<img src="img/diploma.png" width="26" alt="icon">`;
            if (extension === 'pdf') iconFileCompress = `<img src="img/pdf.svg" width="26" alt="icon">`;
            if (extension === 'gif') iconFileCompress = `<img src="img/gif.png" width="26" alt="icon">`;
            if (extension === 'dll') iconFileCompress = `<img src="img/dll.png" width="26" alt="icon">`;
            if (extension === 'wav') iconFileCompress = `<img src="img/wav-file.svg" width="26" alt="icon">`;
            if (extension === 'swf') iconFileCompress = `<img src="img/swf.png" width="26" alt="icon">`;
            if (extension === 'h') iconFileCompress = `<img src="img/letter-c.svg" width="26" alt="icon">`;
            if (extension === 'c') iconFileCompress = `<img src="img/letter-c.svg" width="26" alt="icon">`;
            if (extension === 'sln') iconFileCompress = `<img src="img/sln-2272.png" width="26" alt="icon">`;
            if (extension === 'lua') iconFileCompress = `<img src="img/half-moon.png" width="26" alt="icon">`;
            if (extension === 'cpp') iconFileCompress = `<img src="img/c-.png" width="26" alt="icon">`;
            var iconFile = iconFileCompress;

            var tr = document.createElement('tr');
            var tdName = document.createElement('td');
            tdName.setAttribute('fullpath', item['path']);
            var itemName = `<span class="text-white" style="width: 20px;overflow: hidden;white-space: nowrap;text-overflow: ellipsis;flex-grow: 1;">${item['name']}</span>`;
            if (item['typeFile'] === 'folder') {
                tdName.innerHTML = `<div onclick="setPath('${item['path']}')">${iconFile} &nbsp;&nbsp; ${itemName}</div>`;
            } else if (item['isImage']) {
                tdName.innerHTML = `<div onclick="showImage('${item['path']}', '${item['isImage']}')">${iconFile} &nbsp;&nbsp;${itemName}</div>`;
            } else {
                tdName.innerHTML = `<div onclick="showEditor('${item['typeFile']}', '${item['path']}')">${iconFile} &nbsp;&nbsp; ${itemName}</div>`;
            }
            var tdCheck = document.createElement('td');
            tdCheck.classList.add('text-white');
            tdCheck.innerHTML = `<input type="checkbox" class="form-check-input checkboxFileList" value="'${item.name}'">`;
            tr.appendChild(tdCheck);
            tdName.setAttribute('style', 'max-width: 50px; height: 10px !important; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;');


            tr.appendChild(tdName);
            var tdSize = document.createElement('td');
            tdSize.classList.add('text-white');
            tdSize.textContent = item.size;
            tr.appendChild(tdSize);
            var tdType = document.createElement('td');
            tdType.classList.add('text-white');
            tdType.textContent = item.typeFile === 'folder' ? 'Pasta' : item.typeFile.toUpperCase();
            if (!tdType.textContent) tdType.textContent = 'Desconhecido';
            tr.appendChild(tdType);

            var tdPermissions = document.createElement('td');
            tdPermissions.classList.add('text-white');
            tdPermissions.textContent = item.permissions;
            tdPermissions.setAttribute('style', 'max-width: 50px;');
            tr.appendChild(tdPermissions);
            var actions = document.createElement('td');
            actions.classList.add('text-white');
            actions.setAttribute('style', 'max-width: 50px;');

            if (item['typeFile'] !== 'folder') {
                actions.innerHTML = `<a class="btn btn-info" onclick="downloadFile('${item.path}')"><i class="fa-regular fa-download"></i></a>`;
            }
            actions.innerHTML += `&nbsp;<a class="btn btn-danger" onclick="deleteFile('${item.path}')"><i class="fa-regular fa-trash"></i></a>`;
            actions.innerHTML += `&nbsp;<a class="btn btn-warning" onclick="renameItem('${item.path}')"><i class="fa-regular fa-edit"></i></a>`;
            actions.setAttribute('style', 'max-width: 50px;');
            tr.appendChild(actions);

            tbody.appendChild(tr);
        });
    }


    function renameItem(path) {
        var splp = path;
        const nameforRenamed = splp.split('/')[splp.split('/').length - 1];
        Swal.fire({
            title: 'Renomear item',
            input: 'text',
            inputLabel: `Renomeando: (${nameforRenamed})`,
            color: '#fff',
            inputPlaceholder: 'Digite o novo nome',
            inputValue: nameforRenamed,
            showCancelButton: true,
            confirmButtonText: 'Renomear',
            cancelButtonText: 'Cancelar',
            confirmButtonColor: '#7367f0',
            cancelButtonColor: '#424659',
            background: '#1c2f48',
            inputValidator: (value) => {
                if (!value) {
                    return 'Você precisa digitar um nome';
                }
            }
        }).then((result) => {
            if (result.isConfirmed) {
                const renameStatusFunction = (path, newName) => {
                    const toke = $('#fp').text();
                    const replacer = path.replace(nameforRenamed, newName);
                    fetch(`renameItem?tokenBrowser=${toke}&path=${path}&newName=${replacer}`)
                        .then(async response => await response.json())
                        .then(async data => {
                            if (data.success) {
                                Swal.fire({
                                    icon: 'success',
                                    title: 'Sucesso!',
                                    text: 'Seu arquivo foi renomeado com sucesso!',
                                    showConfirmButton: false,
                                    color: '#fff',
                                    confirmButtonColor: '#7367f0',
                                    cancelButtonColor: '#424659',
                                    background: '#1c2f48',
                                    timer: 2000
                                });
                            }
                            console.log(data)
                            const fopenDynamicToken = $('#fp').text();
                            const pathUsing = $('#pathInvisible').text();
                            setItemsInTbody(
                                (await asyncGet(`/syncPath?tokenBrowser=${fopenDynamicToken}&path=${pathUsing}`))['information'],
                                'filesList'
                            );
                        });
                }
                renameStatusFunction(path, result.value);
            }
        })
    }

    function deleteFile(path) {
        Swal.fire({
            title: 'Tem certeza?',
            text: 'Você não poderá reverter esta ação!',
            icon: 'warning',
            color: '#fff',
            confirmButtonColor: '#7367f0',
            cancelButtonColor: '#424659',
            background: '#1c2f48',
            showCancelButton: true,
            confirmButtonText: 'Sim, excluir!',
            cancelButtonText: 'Cancelar'
        }).then((result) => {
            if (result.isConfirmed) {
                const deleteStatusFunction = (path) => {
                    var toke = $('#fp').text();
                    fetch(`deleteFile?tokenBrowser=${toke}&path=${path}`
                    )
                        .then(response => response.text())
                        .then(async data => {
                            const fopenDynamicToken = $('#fp').text();
                            const pathUsing = $('#pathInvisible').text();
                            setItemsInTbody(
                                (await asyncGet(`/syncPath?tokenBrowser=${fopenDynamicToken}&path=${pathUsing}`))['information'],
                                'filesList'
                            );
                            return Swal.fire({
                                icon: 'success',
                                title: 'Sucesso!',
                                text: 'Seu arquivo foi excluído com sucesso!',
                                showConfirmButton: false,
                                color: '#fff',
                                confirmButtonColor: '#7367f0',
                                cancelButtonColor: '#424659',
                                background: '#1c2f48',
                                timer: 2000
                            });
                        });
                }
                deleteStatusFunction(path);
            }
        })

    }

    function isCompressedExtension(extension) {
        const compressedExtensions = ['zip', '7z', 'rar', 'tar', 'gz', 'bz2', 'xz'];
        return compressedExtensions.includes(extension.toLowerCase());
    }


    async function showEditor(type, path) {

        if (!isCompressedExtension(type)) {
            let editor = ace.edit("editor");
            const fopenDynamicToken = $('#fp').text();
            let uriEncodedPath = encodeURIComponent(path);
            document.getElementById('hiddenFileEdit').innerHTML = path;
            let content = await asyncGet(`getFile?tokenBrowser=${fopenDynamicToken}&path=${uriEncodedPath}`);
            editor.setValue(content['information'], -1);
            editor.getSession().setUseWorker(false);
            editor.setShowPrintMargin(false);
            editor.setFontSize(16);
            $('#nameFileForEdit').text(path.split('/').pop());
            editor.setTheme("ace/theme/dracula");
            editor.getSession().setMode(`ace/mode/${type}`);
            editor.setHighlightActiveLine(true);


            if (type === 'html') editor.getSession().setMode("ace/mode/html");
            if (type === 'js') editor.getSession().setMode("ace/mode/javascript");
            if (type === 'css') editor.getSession().setMode("ace/mode/css");
            if (type === 'scss') editor.getSession().setMode("ace/mode/scss");
            if (type === 'py') editor.getSession().setMode("ace/mode/python");
            if (type === 'php') editor.getSession().setMode("ace/mode/php");
            if (type === 'json') editor.getSession().setMode("ace/mode/json");
            if (type === 'yml') editor.getSession().setMode("ace/mode/yaml");
            if (type === 'md') editor.getSession().setMode("ace/mode/markdown");
            if (type === 'txt') editor.getSession().setMode("ace/mode/text");
            if (type === 'LICENSE') editor.getSession().setMode("ace/mode/text");
            if (type === 'dist') editor.getSession().setMode("ace/mode/text");
            if (type === 'lock') editor.getSession().setMode("ace/mode/text");
            if (type === 'ttf') editor.getSession().setMode("ace/mode/text");
            if (type === 'woff') editor.getSession().setMode("ace/mode/text");
            if (type === 'eot') editor.getSession().setMode("ace/mode/text");
            if (type === 'xml') editor.getSession().setMode("ace/mode/xml");
            if (type === 'png') editor.getSession().setMode("ace/mode/text");
            if (type === 'jpg') editor.getSession().setMode("ace/mode/text");
            if (type === 'Gemfile') editor.getSession().setMode("ace/mode/ruby");
            if (type === 'Makefile') editor.getSession().setMode("ace/mode/text");
            if (type === 'eps') editor.getSession().setMode("ace/mode/text");
            if (type === 'mkv') editor.getSession().setMode("ace/mode/text");
            if (type === 'mp3') editor.getSession().setMode("ace/mode/text");
            if (type === 'mp4') editor.getSession().setMode("ace/mode/text");
            if (type === 'svg') editor.getSession().setMode("ace/mode/html");
            if (type === 'ts') editor.getSession().setMode("ace/mode/javascript");
            if (type === 'cpp') editor.getSession().setMode("ace/mode/c_cpp");
            if (type === 'go') editor.getSession().setMode("ace/mode/golang");
            if (type === 'exe') editor.getSession().setMode("ace/mode/text");
            if (type === 'deb') editor.getSession().setMode("ace/mode/text");
            if (type === 'zip') editor.getSession().setMode("ace/mode/text");
            if (type === 'rar') editor.getSession().setMode("ace/mode/text");
            if (type === '7z') editor.getSession().setMode("ace/mode/text");
            if (type === 'tar') editor.getSession().setMode("ace/mode/text");
            if (type === 'gz') editor.getSession().setMode("ace/mode/text");
            if (type === 'bz2') editor.getSession().setMode("ace/mode/text");
            if (type === 'xz') editor.getSession().setMode("ace/mode/text");
            if (type === 'c') editor.getSession().setMode("ace/mode/c_cpp");
            if (type === 'h') editor.getSession().setMode("ace/mode/c_cpp");
            if (type === 'cfg') editor.getSession().setMode("ace/mode/c_cpp");
            $('#edit-code').modal('show');
            setTimeout(() => removeInlineSuggestion(), 200);
            const showPreview = [
                'html',
                'htm',
                'svg',
                'pdf'
            ];
            const markdwonExtensions = [
                'md',
                'markdown',
                'template',
                'xml'
            ];

            if (showPreview.includes(type)) {
                $('#preview').css('display', 'block');
                $('#editor').css('width', '50%');
                $('#preview-iframe').css('display', 'block');
                $('#markdown-content').css('display', 'none');
                $('#preview').attr('srcdoc', content['information']);


                editor.events.bind('change', function () {
                    $('#preview').css('display', 'block');
                    $('#editor').css('width', '50%');
                    $('#preview-iframe').css('display', 'block');
                    $('#markdown-content').css('display', 'none');
                    const editor = ace.edit("editor");
                    editor.getSession();
                    const content = editor.getValue();
                    const position = editor.getCursorPosition();
                    const preview = document.getElementById('preview');
                    preview.contentWindow.document.open();
                    preview.contentWindow.document.write(content);
                    preview.contentWindow.document.close();
                    $('#preview').attr('srcdoc', content);
                });
            } else if (markdwonExtensions.includes(type)
                || path.split('/').pop().includes('README')
                || path.split('/').pop().includes('RELEASE')
                || path.split('/').pop().includes('CHANGELOG')
                || path.split('/').pop().includes('HISTORY')
                || path.split('/').pop().includes('CONTRIBUTING')
                || path.split('/').pop().includes('CONTRIBUTORS')
                || path.split('/').pop().includes('AUTHORS')
                || path.split('/').pop().includes('CODE_OF_CONDUCT')
                || path.split('/').pop().includes('SECURITY')
                || path.split('/').pop().includes('LICENSE')
                || path.split('/').pop().includes('COPYING')
                || path.split('/').pop().includes('COPYRIGHT')
                || path.split('/').pop().includes('NOTICE')
                || path.split('/').pop().includes('PATENTS')
                || path.split('/').pop().includes('LEGAL')
                || path.split('/').pop().includes('LICENCE')
                || path.split('/').pop().includes('INSTALL')
            ) {
                $('#preview').css('display', 'block');
                $('#editor').css('width', '50%');
                $('#preview-iframe').css('display', 'none');
                $('#markdown-content').css('display', 'block');
                document.getElementById('markdown-content').innerHTML = marked.parse(content['information']);
                console.log('siafsrfgr 2222222222222222222')

            } else {
                console.log('opa')
                $('#preview').css('display', 'none');
                $('#editor').css('width', '100%');
            }


            editor.commands.addCommand({
                name: 'beautify',
                bindKey: {win: 'Ctrl-Shift-L', mac: 'Command-Shift-L'},
                exec: async () => {
                    console.log('saved')
                    const editor = ace.edit("editor");
                    const YOUR_CODE = editor.getValue();
                    const newCode = await prettier.format(YOUR_CODE, {
                        plugins: prettierPlugins,
                        parser: "php",
                    });
                    editor.setValue(newCode, -1);
                },
                readOnly: true
            });


        } else {
            $('#modalFileCompress').modal('show');
            const namefile = path.split('/').pop();
            $('#nameFileUncompress').html(`(&nbsp;<img src="img/zip.png" width="26" alt="icon">&nbsp;${namefile}&nbsp;<span class="ml-2 badge bg-danger rounded-pill badge-notifications" id="totalFilesCompress">0</span>&nbsp;)`);
            const realpath = path.split('/').slice(0, -1).join('/') + '/' + namefile;
            const spinnerPulse = `<div class="spinner-grow" role="status"><span class="visually-hidden"></span></div>`;
            const namePathToExtract = path.split('/').slice(0, -1).join('/') + '/' + namefile.split('.').slice(0, -1).join('.');
            $('#addressPathToExtract').text(namePathToExtract.replace('/', ''));
            $('#compressDetails').html(`<div class="text-center">${spinnerPulse}</div>`);
            $.ajax({
                url: `getArchiveDetails?tokenBrowser=${$('#fp').text()}&path=${realpath}`,
                type: 'GET',
                success: function (data) {
                    const listElementBuffer = [];
                    for (let i = 0; i < data['list'].length; i++) {
                        let extension = data['list'][i].split('.').pop();
                        if (extension.includes('/')) extension = extension.split('/').pop();
                        let iconFileCompress = `<img src="img/linux.png" width="26" alt="icon">`;
                        if (extension === 'py') iconFileCompress = `<img src="img/python.png" width="26" alt="icon">`;
                        if (extension === 'txt') iconFileCompress = `<img src="img/txt.png" width="26" alt="icon">`;
                        if (extension === 'php') iconFileCompress = `<img src="img/php.png" width="26" alt="icon">`;
                        if (extension === 'json') iconFileCompress = `<img src="img/json.png" width="26" alt="icon">`;
                        if (extension === 'mkv') iconFileCompress = `<img src="img/me.png" width="26" alt="icon">`;
                        if (extension === 'LICENSE') iconFileCompress = `<img src="img/diploma.png" width="26" alt="icon">`;
                        if (extension === 'yml') iconFileCompress = `<img src="img/yaml.png" width="26" alt="icon">`;
                        if (extension === 'dist') iconFileCompress = `<img src="img/dist.png" width="26" alt="icon">`;
                        if (extension === 'md') iconFileCompress = `<img src="img/olho.png" width="26" alt="icon">`;
                        if (extension === 'css') iconFileCompress = `<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b2/Bootstrap_logo.svg/2560px-Bootstrap_logo.svg.png" width="26" alt="icon">`;
                        if (extension === 'scss') iconFileCompress = `<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b2/Bootstrap_logo.svg/2560px-Bootstrap_logo.svg.png" width="26" alt="icon">`;
                        if (extension === 'lock') iconFileCompress = `<img src="img/trancar.png" width="26" alt="icon">`;
                        if (extension === 'ttf') iconFileCompress = `<img src="img/font-file.png" width="26" alt="icon">`;
                        if (extension === 'woff') iconFileCompress = `<img src="img/font-file.png" width="26" alt="icon">`;
                        if (extension === 'eot') iconFileCompress = `<img src="img/trancar.png" width="26" alt="icon">`;
                        if (extension === 'xml') iconFileCompress = `<img src="img/xml-file.png" width="26" alt="icon">`;
                        if (extension === 'png') iconFileCompress = `<img src="img/image.png" width="26" alt="icon">`;
                        if (extension === 'jpg') iconFileCompress = `<img src="img/image.png" width="26" alt="icon">`;
                        if (extension === 'html') iconFileCompress = `<img src="img/html-5.png" width="26" alt="icon">`;
                        if (extension === 'js') iconFileCompress = `<img src="img/js.png" width="26" alt="icon">`;
                        if (extension === 'go') iconFileCompress = `<img src="img/go.png" width="26" alt="icon">`;
                        if (extension === 'exe') iconFileCompress = `<img src="img/windows.png" width="26" alt="icon">`;
                        if (extension === 'deb') iconFileCompress = `<img src="img/linux.png" width="26" alt="icon">`;
                        if (extension === 'cpp') iconFileCompress = `<img src="https://cdn-icons-png.flaticon.com/512/8304/8304381.png" width="26" alt="icon">`;
                        if (extension === 'zip') iconFileCompress = `<img src="img/zip.png" width="26" alt="icon">`;
                        if (extension === 'rar') iconFileCompress = `<img src="img/zip.png" width="26" alt="icon">`;
                        if (extension === '7z') iconFileCompress = `<img src="img/zip.png" width="26" alt="icon">`;
                        if (extension === 'tar') iconFileCompress = `<img src="img/zip.png" width="26" alt="icon">`;
                        if (extension === 'gz') iconFileCompress = `<img src="img/zip.png" width="26" alt="icon">`;
                        if (extension === 'bz2') iconFileCompress = `<img src="img/zip.png" width="26" alt="icon">`;
                        if (extension === 'xz') iconFileCompress = `<img src="img/zip.png" width="26" alt="icon">`;
                        if (extension === 'svg') iconFileCompress = `<img src="img/photoshop-lightroom.png" width="26" alt="icon">`;
                        if (extension === 'mp3') iconFileCompress = `<img src="img/music-player.png" width="26" alt="icon">`;
                        if (extension === 'mp4') iconFileCompress = `<img src="img/me.png" width="26" alt="icon">`;
                        if (extension === 'Gemfile') iconFileCompress = `<img src="img/diamond.png" width="26" alt="icon">`;
                        if (extension === 'Makefile') iconFileCompress = `<img src="img/letter-m.png" width="26" alt="icon">`;
                        if (extension === 'eps') iconFileCompress = `<img src="img/photoshop-camera.png" width="26" alt="icon">`;
                        listElementBuffer.push(`<li class="list-group-item">${iconFileCompress} &nbsp;&nbsp;${data['list'][i]}</li>`);
                    }
                    if (data['list'].length > 6) $('#scrollToEndButtonFather').css('display', 'block');
                    else $('#scrollToEndButtonFather').css('display', 'none');
                    $('#totalFilesCompress').text(data['list'].length);
                    $('#compressDetails').html(listElementBuffer.join(''));
                    $('#decompressRealFileName').text(namefile);
                }
            });
        }
    }

    function setPath(path) {
        localStorage.setItem('pathInvisible', path);
        document.getElementById('pathInvisible').innerHTML = path;

        const splitPath = path.split('/');
        splitPath.forEach(function (item, index) {
            if (index === 0) {
                document.getElementById('visualPath').innerHTML = `<span class="text-white"></span> <a class="text-secondary" onclick="setPath('/')">${item}</a>`;
            } else if (index === splitPath.length - 1) {
                document.getElementById('visualPath').innerHTML += `<span class="text-white">&nbsp;/</span> <span class="text-blue">${item}</span>`;
            } else {
                document.getElementById('visualPath').innerHTML += `<span class="text-white">&nbsp;/</span> <a class="text-secondary" onclick="setPath('${splitPath.slice(0, index + 1).join('/')}')">${item}</a>`;
            }
        });
        adjustPath()
    }


    function showImage(path, isVideo = false) {
        var toke = $('#fp').text();
        if (isVideo === 'video') {
            Swal.fire({
                html: `<video width="80%"  src="imageBase64?tokenBrowser=${toke}&path=${path}" controls autoplay></video>`,
                title: path,
                background: '#1c2f48',
                color: '#fff',
                showCloseButton: true,
                showCloseText: true,
                showConfirmButton: false,
                showCancelButton: false,
                width: '70%',
                height: '70%',
            })
        } else {
            Swal.fire({
                html: `<img src="imageBase64?tokenBrowser=${toke}&path=${path}" width="100%">`,
                title: path,
                background: '#1c2f48',
                color: '#fff',
                showCloseButton: true,
                showCloseText: true,
                showConfirmButton: false,
                showCancelButton: false,
                width: 'auto',
                height: 'auto',
            })

        }

    }

    function backPath() {
        const path = document.getElementById('pathInvisible').innerHTML;
        const splitPath = path.split('/');
        if (splitPath.length > 1) {
            splitPath.pop();
            setPath(splitPath.join('/'));
        }
    }

    function saveFile() {

        var editor = ace.edit("editor");
        var content = editor.getValue();
        var tokenBrowser = $('#fp').text();
        showEditor(document.getElementById('hiddenFileEdit').innerHTML.split('.').pop(), document.getElementById('hiddenFileEdit').innerHTML);
        fetch('refactorFile?tokenBrowser=' + tokenBrowser, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                path: document.getElementById('hiddenFileEdit').innerHTML,
                content: content
            })
        })
            .then(response => response.text())
            .then(async data => {
                const fopenDynamicToken = $('#fp').text();
                const pathUsing = $('#pathInvisible').text();
                setItemsInTbody(
                    (await asyncGet(`/syncPath?tokenBrowser=${fopenDynamicToken}&path=${pathUsing}`))['information'],
                    'filesList'
                );
                $('#edit-code').modal('hide');
                Swal.fire({
                    icon: 'success',
                    title: 'Sucesso!',
                    text: 'Seu arquivo foi salvo com sucesso!',
                    showConfirmButton: false,
                    color: '#fff',
                    background: '#1c2f48',
                    timer: 2000
                });
            });
    }

</script>


<style>
    .swal2-close {
        border: none !important;
    }
</style>